<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <title></title>  -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4cc9f0;
      --danger-color: #f72585;
      --success-color: #4ad66d;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --gray-color: #6c757d;
      --border-radius: 8px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Roboto', sans-serif; background: #f5f7fa; color: var(--dark-color); line-height: 1.6; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid #e0e0e0; }
    h1 { color: var(--primary-color); font-size: 28px; display: flex; align-items: center; gap: 10px; }
    .status-bar { display: flex; gap: 20px; }
    .status-card { background: white; padding: 10px 15px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); display: flex; align-items: center; gap: 8px; }
    .status-card i { font-size: 18px; }
    .online-users { color: var(--primary-color); }
    .data-count { color: var(--success-color); }
    .panel { background: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding: 20px; margin-bottom: 20px; }
    .panel-title { font-size: 18px; margin-bottom: 15px; color: var(--primary-color); display: flex; align-items: center; gap: 8px; }
    .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
    input[type="text"], input[type="file"], input[type="password"] { flex: 1; padding: 12px 15px; border: 1px solid #ddd; border-radius: var(--border-radius); font-size: 16px; transition: var(--transition); }
    input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2); }
    button { padding: 12px 20px; border: none; border-radius: var(--border-radius); background: var(--primary-color); color: white; font-weight: 500; cursor: pointer; transition: var(--transition); display: flex; align-items: center; gap: 8px; }
    button:hover { background: var(--secondary-color); transform: translateY(-2px); }
    button.secondary { background: var(--light-color); color: var(--dark-color); }
    button.secondary:hover { background: #e9ecef; }
    button.danger { background: var(--danger-color); }
    button.danger:hover { background: #d1146a; }
    .file-group { display: flex; gap: 10px; align-items: center; }
    .file-input-wrapper { flex: 1; position: relative; }
    .file-input-wrapper input[type="file"] { width: 100%; padding: 12px 15px; opacity: 0; position: absolute; left: 0; top: 0; cursor: pointer; }
    .file-input-label { display: block; padding: 12px 15px; border: 1px dashed #ddd; border-radius: var(--border-radius); text-align: center; color: var(--gray-color); cursor: pointer; transition: var(--transition); }
    .file-input-wrapper:hover .file-input-label { border-color: var(--primary-color); color: var(--primary-color); }
    .table-container { overflow-x: auto; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; background: white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); }
    th { background: var(--primary-color); color: white; padding: 15px; text-align: left; font-weight: 500; }
    td { padding: 12px 15px; border-bottom: 1px solid #eee; }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: #f8f9fa; }
    .hash-cell { font-family: 'Courier New', monospace; font-size: 14px; word-break: break-all; }
    .meta-info { font-size: 12px; color: var(--gray-color); margin-top: 5px; }
    .action-buttons { display: flex; gap: 8px; }
    .empty-state { text-align: center; padding: 40px 20px; color: var(--gray-color); }
    .empty-state i { font-size: 50px; margin-bottom: 15px; color: #e0e0e0; }
    .search-highlight { background: #fff3bf; padding: 2px 0; }
    .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); }
    .modal-content { background: #fefefe; margin: 15% auto; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); width: 400px; max-width: 90%; }
    .modal-title { margin-bottom: 15px; color: var(--primary-color); font-size: 20px; }
    .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
    .notification { position: fixed; top: 10px; right: 10px; background: var(--success-color); color: white; padding: 10px 20px; border-radius: var(--border-radius); display: none; z-index: 1000; box-shadow: var(--box-shadow); }
    @media (max-width: 768px) {
      .input-group, .file-group { flex-direction: column; }
      .action-buttons { flex-direction: column; }
      header { flex-direction: column; align-items: flex-start; gap: 15px; }
      .status-bar { width: 100%; justify-content: space-between; }
      .modal-content { margin: 30% auto; }
    }
  </style>
  
  <!-- Primary Meta Tags -->
<title>Iq920 SYS đang năng</title>
<meta name="title" content="Iq920 SYS đa năng" />
<meta name="description" content="iq920.fun là một hệ thống điều tra thông minh, chuyên thu thập và quản lý thông tin với khả năng mã hoá dữ liệu bằng SHA-256 và MD5, đảm bảo tính bảo mật và toàn vẹn. Hệ thống cho phép theo dõi người dùng online, xuất/nhập dữ liệu mã hoá và cung cấp các công cụ giám sát linh hoạt, phù hợp với nhu cầu điều tra, phân tích hoặc theo dõi thông tin nhạy cảm." />

  
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2PP0NMFNV0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-2PP0NMFNV0');
  </script>

  <link rel="icon" type="image/x-icon" href="adam.png">


  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1987179079515014"
     crossorigin="anonymous"></script>
  
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-search"></i> Hệ thống điều tra thông minh</h1>
      <div class="status-bar">
        <div class="status-card online-users"><i class="fas fa-users"></i> Online: <span id="onlineUsers">0</span></div>
        <div class="status-card data-count"><i class="fas fa-database"></i> Dữ liệu: <span id="dataCount">0</span></div>
      </div>
    </header>
    <div class="panel">
      <h2 class="panel-title"><i class="fas fa-plus-circle"></i> Thêm dữ liệu mới</h2>
      <div class="input-group">
        <input type="text" id="dataInput" placeholder="Nhập thông tin cần điều tra...">
        <button onclick="addData()"><i class="fas fa-plus"></i> Thêm</button>
      </div>
    </div>
    <div class="panel">
      <h2 class="panel-title"><i class="fas fa-search"></i> Tìm kiếm dữ liệu</h2>
      <div class="input-group">
        <input type="text" id="searchInput" placeholder="Nhập từ khóa tìm kiếm..." onkeyup="searchData()">
      </div>
    </div>
    <div class="panel">
      <h2 class="panel-title"><i class="fas fa-file-import"></i> Quản lý dữ liệu</h2>
      <div class="file-group">
        <div class="file-input-wrapper">
          <input type="file" id="fileInput" accept=".json">
          <label for="fileInput" class="file-input-label"><i class="fas fa-cloud-upload-alt"></i> Chọn file JSON để nhập dữ liệu</label>
        </div>
        <button onclick="showModal('importModal')" class="secondary"><i class="fas fa-file-import"></i> Nhập</button>
        <button onclick="showModal('backupModal')" class="secondary"><i class="fas fa-file-export"></i> Backup</button>
      </div>
    </div>
    <div class="panel">
      <h2 class="panel-title"><i class="fas fa-table"></i> Danh sách dữ liệu</h2>
      <div class="table-container">
        <table>
          <thead><tr><th>SHA-256</th><th>MD5 (Key)</th><th>Hành động</th></tr></thead>
          <tbody id="dataTable">
            <tr><td colspan="3" class="empty-state"><i class="fas fa-database"></i><p>Không có dữ liệu nào được tìm thấy</p></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div id="backupModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title"><i class="fas fa-file-export"></i> Backup dữ liệu</h3>
      <p>Nhập mật khẩu để mã hóa dữ liệu backup:</p>
      <input type="password" id="backupPassword" placeholder="Nhập mật khẩu mã hóa">
      <div class="modal-actions">
        <button onclick="hideModal('backupModal')" class="secondary">Hủy</button>
        <button onclick="performBackup()">Backup</button>
      </div>
    </div>
  </div>
  <div id="importModal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title"><i class="fas fa-file-import"></i> Nhập dữ liệu</h3>
      <p>Nhập mật khẩu để giải mã dữ liệu:</p>
      <input type="password" id="importPassword" placeholder="Nhập mật khẩu giải mã">
      <div class="modal-actions">
        <button onclick="hideModal('importModal')" class="secondary">Hủy</button>
        <button onclick="performImport()">Nhập</button>
      </div>
    </div>
  </div>
  <div id="notification" class="notification"><i class="fas fa-bell"></i> Có dữ liệu mới được thêm!</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, set, remove, onValue, child } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = { databaseURL: "https://iqvocucdenhat0-default-rtdb.asia-southeast1.firebasedatabase.app/" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dataRef = ref(db, "dieuTra");
    const usersRef = ref(db, "online-users");

    const getUserIP = async () => (await fetch("https://api64.ipify.org?format=json")).json().then(d => d.ip).catch(() => "Unknown");
    const getUserId = () => {
      let userId = document.cookie.match(/(?:(?:^|.*;\s*)userId\s*=\s*([^;]*).*$)|^.*$/)[1];
      if (!userId) {
        userId = `user_${Date.now()}${Math.random().toString(36).substr(2, 9)}`;
        document.cookie = `userId=${userId}; path=/; max-age=1800`;
      }
      return userId;
    };
    const userId = getUserId();

    const updateUserStatus = async () => set(ref(db, `online-users/${userId}`), { lastActive: Date.now(), ip: await getUserIP(), cookieId: userId });
    const cleanInactiveUsers = () => onValue(usersRef, s => {
      const now = Date.now();
      s.forEach(u => now - u.val().lastActive > 1800000 && remove(ref(db, `online-users/${u.key}`)));
    }, { onlyOnce: true });

    onValue(usersRef, s => document.getElementById("onlineUsers").textContent = s.exists() ? Object.keys(s.val()).length : 0);

    let lastDataCount = 0;
    onValue(dataRef, s => {
      const count = s.exists() ? Object.keys(s.val()).length : 0;
      document.getElementById("dataCount").textContent = count;
      if (count > lastDataCount && lastDataCount !== 0) {
        const notif = document.getElementById("notification");
        notif.style.display = "block";
        setTimeout(() => notif.style.display = "none", 3000);
      }
      lastDataCount = count;
      renderTable(s);
    });

    const hashMD5 = data => CryptoJS.MD5(data).toString();
    const hashSHA256 = data => CryptoJS.SHA256(data).toString();
    const getTime = (tz) => new Date().toLocaleString(tz === "VN" ? "vi-VN" : "ko-KR", { timeZone: tz === "VN" ? "Asia/Ho_Chi_Minh" : "Asia/Seoul" });
    const highlightText = (text, search) => search ? text.replace(new RegExp(`(${search})`, 'gi'), '<span class="search-highlight">$1</span>') : text;

    const renderTable = (snapshot, search = "") => {
      const tbody = document.getElementById("dataTable");
      if (!snapshot.exists()) return tbody.innerHTML = '<tr><td colspan="3" class="empty-state"><i class="fas fa-database"></i><p>Không có dữ liệu nào được tìm thấy</p></td></tr>';
      const data = Object.entries(snapshot.val()).map(([key, val]) => ({ key, ...val })).filter(d => !search || d.sha.includes(search) || d.hashedKey.includes(search));
      tbody.innerHTML = data.length ? data.map(d => `
        <tr>
          <td class="hash-cell">${highlightText(d.sha, search)}<div class="meta-info"><div><i class="far fa-clock"></i> VN: ${d.timeVN}</div><div><i class="far fa-clock"></i> KR: ${d.timeKR}</div></div></td>
          <td class="hash-cell">${highlightText(d.hashedKey, search)}<div class="meta-info"><i class="fas fa-globe"></i> IP: ${d.ip || "Unknown"}</div></td>
          <td><div class="action-buttons"><button class="danger" onclick="deleteData('${d.key}')"><i class="fas fa-trash-alt"></i> Xóa</button></div></td>
        </tr>`).join("") : '<tr><td colspan="3" class="empty-state"><i class="fas fa-search"></i><p>Không tìm thấy kết quả phù hợp</p></td></tr>';
    };

    window.addData = async () => {
      const input = document.getElementById("dataInput");
      const data = input.value.trim();
      if (!data) return alert("Vui lòng nhập dữ liệu!"), input.focus();
      const md5Key = hashMD5(data);
      await set(child(dataRef, md5Key), { sha: hashSHA256(data), original: data, hashedKey: md5Key, ip: await getUserIP(), timeVN: getTime("VN"), timeKR: getTime("KR") });
      input.value = "";
      input.focus();
    };

    window.deleteData = key => confirm("Bạn có chắc chắn muốn xóa dữ liệu này?") && remove(child(dataRef, key));
    window.searchData = () => onValue(dataRef, s => renderTable(s, document.getElementById("searchInput").value.toLowerCase()), { onlyOnce: true });

    window.showModal = id => document.getElementById(id).style.display = "block";
    window.hideModal = id => (document.getElementById(id).style.display = "none", document.getElementById(id === "backupModal" ? "backupPassword" : "importPassword").value = "");
    window.performBackup = () => {
      const pwd = document.getElementById("backupPassword").value;
      if (!pwd) return alert("Vui lòng nhập mật khẩu mã hóa!");
      onValue(dataRef, s => {
        if (!s.exists()) return hideModal("backupModal"), alert("Không có dữ liệu để backup!");
        const encrypted = Object.fromEntries(Object.entries(s.val()).map(([k, v]) => [k, { ...v, original: CryptoJS.AES.encrypt(v.original, pwd).toString() }]));
        const blob = new Blob([JSON.stringify(encrypted, null, 2)], { type: "application/json" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `backup-${new Date().toISOString().slice(0,10)}.json`;
        a.click();
        hideModal("backupModal");
      }, { onlyOnce: true });
    };

    window.performImport = () => {
      const pwd = document.getElementById("importPassword").value;
      const file = document.getElementById("fileInput").files[0];
      if (!pwd || !file) return alert("Vui lòng nhập mật khẩu và chọn file!");
      if (!confirm("Bạn có chắc muốn nhập dữ liệu từ file này?")) return hideModal("importModal");
      const reader = new FileReader();
      reader.onload = e => {
        const data = JSON.parse(e.target.result);
        let count = 0;
        Object.values(data).forEach(d => {
          const decrypted = CryptoJS.AES.decrypt(d.original, pwd).toString(CryptoJS.enc.Utf8);
          if (decrypted) set(child(dataRef, d.hashedKey), { ...d, original: decrypted }), count++;
        });
        hideModal("importModal");
        document.getElementById("fileInput").value = "";
        alert(`Đã nhập thành công ${count} data.`);
      };
      reader.readAsText(file);
    };

    updateUserStatus();
    setInterval(() => { updateUserStatus(); cleanInactiveUsers(); }, 300000);
    document.getElementById("dataInput").addEventListener("keypress", e => e.key === "Enter" && addData());
    window.onclick = e => e.target.className === "modal" && hideModal(e.target.id);
  </script>
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'92a8f6dd1ac7bd19',t:'MTc0MzY4NzQ4NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>